# **报告：“灵魂谐振”基础天赋树设计方案**

本设计方案遵循《泰拉瑞亚》成长型模组 design 理念深度分析（1）的最终结论，旨在提供一个完整的、可行的“灵魂谐振系统”（The Soul-Attuned System）基础天赋树实现方案。方案严格按照“以角色为中心”、“进程门控平衡”及“质变奖励”的设计哲学构建 1。

---

## **第 1 部分：核心架构与谐振进程**

本部分定义了驱动玩家成长的底层数学模型和核心规则。这是确保系统平衡性、合理性与原版游戏循环相契合的“引擎室”，严格遵循了分析报告中的核心建议 1。

### **1.1. 经验循环**

经验（XP）循环是玩家成长的基础。其设计必须平滑，既能奖励玩家的“肝”（Grind），又不能破坏游戏的核心进程 1。

- 经验获取（XP Source）  
  经验的唯一来源是击杀敌对 NPC。为了确保平衡性并避免等级爆炸（如击败 Boss 瞬升数千级），本方案采用了分析报告中推荐的“优秀设计”1:

  1. 动态 XP 公式： 采用基于敌人属性的动态公式，确保更强的敌人提供更合理的 XP 1。

     $$XP = (最大生命 / 100) \times (1 + (防御 / 10)) \times (1 + (伤害 / 25))$$

  2. **Boss XP 排除：** 遵循“彻底杜绝等级爆炸”的解决方案 1，**Boss 在被击败时不提供任何 XP**。击败 Boss 的唯一奖励是解锁下一个“谐振阶段”（见 1.2 节）。

- 升级曲线（Leveling Curve）  
  为匹配玩家在游戏中后期（特别是困难模式下）不断增长的刷怪能力，升级所需的 XP 必须呈非线性增长。本方案采用分析报告推荐的幂函数公式 1：

  $$下一级所需XP = \text{基础XP} \times (\text{当前等级}^{1.5})$$

  其中“基础 XP”和指数（$1.5$）应作为模组配置（Config）选项，允许玩家根据自己的游戏节奏进行调整。

### **1.2. 世界谐振：进程门控**

这是本系统平衡性的核心支柱。它将 RPG 式的等级成长（路径 B）与《泰拉瑞亚》原版的核心游戏循环（击败 Boss 以解锁新阶段）强行绑定 1。玩家的“最大等级上限”（$MaxLevelCap$）受到他们与世界“谐振”程度的严格限制——即玩家必须击败这个世界的守护者（Boss）1。

这一机制完美地解决了纯粹“角色中心”（路径 B）模组的平衡性灾难。玩家无法在击败第一个 Boss 前就刷到 100 级；他们可以刷到 10 级，但随后 XP 将被“冻结”（或累积但无法升级），直到他们证明自己有能力击败克苏鲁之眼 1。

表 1.2.1: “世界谐振”里程碑与等级上限表  
此表是实现“平衡”、“限制”和“合理性”的具体蓝图，直接来源于分析报告 1。

| 谐振阶段 (Phase) | 最大等级上限 (Max Level Cap) | 解锁触发器 (tModLoader Flag)                    | 设计理念 (Design Rationale)             |
| :--------------- | :--------------------------- | :---------------------------------------------- | :-------------------------------------- |
| 1：起始          | 10 级                        | 游戏开始                                        | 允许初期小幅提升，不足以碾压早期 Boss。 |
| 2：肉山前-早期   | 20 级                        | 击败 克苏鲁之眼 (NPC.downedBoss1)               | 第一个主要 Boss；证明玩家已准备好。     |
| 3：肉山前-中期   | 30 级                        | 击败 骷髅王 (NPC.downedBoss3)                   | 解锁地牢；匹配此挑战。                  |
| 4：困难模式      | 40 级                        | 击败 血肉之墙 (Main.hardMode)                   | 游戏中最大的难度跳跃；模组必须尊重。    |
| 5：机械三王      | 50 级                        | 击败 任意一个 机械 Boss (NPC.downedMechBossAny) | 证明有能力应对困难模式初期。            |
| 6：世纪之花      | 60 级                        | 击败 世纪之花 (NPC.downedPlantBoss)             | 解锁神庙和新装备等级。                  |
| 7：后期          | 70 级                        | 击败 石巨人 (NPC.downedGolemBoss)               | 为挑战月亮领主做准备。                  |
| 8：终局          | 80 级                        | 击败 月亮领主 (NPC.downedMoonlord)              | 原版游戏的最高等级上限。                |

### **1.3. 升级奖励：双轨系统 (Level-Up Rewards: A Dual-Track System)**

#### **1.3.1 质变：天赋点经济 (Qualitative Change: The Talent Point Economy)**

为了“激发玩家的升级兴致”，主要的升级奖励是“天赋点”，用于解锁“里程碑式”的“质变奖励”1。

- **获取机制：** 遵循分析报告的建议，玩家**每 5 级**获得一个“天赋点”1。
- 总点数推算： 鉴于原版游戏的最高等级上限为 80 级（见表 1.2.1）1，玩家在整个游戏流程中总共可获得的天赋点数为：

  $$80 \text{级} / 5 \text{级/点} = 16 \text{ 点}$$

- **16 点预算的平衡意涵：** 16 个点是一个非常有限的预算。为了在 16 点的预算内创造有意义的“选择”，天赋树*必须*是分支的。本设计（第 3 部分）将采用一个三分支结构，总节点数远超 16 个，迫使玩家在“侵攻”、“坚韧”和“效能”之间做出取舍，从而实现真正的“定制化”1。

#### **1.3.2 量变：基础点分配 (Quantitative Change: The Basic Point Allocation)**

我们引入一个并行的“基础点”系统。这确保了每次升级都能立即带来反馈，而“天赋点”则作为长期的里程碑奖励。

- **获取机制：** 玩家**每 1 级**（包括 5, 10, 15 等级）获得 1 个“基础点”。
- **总点数：** 在 80 级的上限下，玩家总共将获得 80 个基础点。
- **分配方式：** 玩家可以在“灵魂核心”UI 的一个附属界面（“基础灵魂”面板）中，随时花费这些点数来永久提升三项核心基础属性。
- **平衡机制：** 该系统采用了\*\*“边际成本递增”\*\*模型

**表 1.3.2: “基础点”分配成本与收益表**

| 属性 (Stat)                 | 每级加成 (Bonus per Rank) | 购买等级 (Ranks) | 每级所需“基础点” (Cost per Rank) |
| :-------------------------- | :------------------------ | :--------------- | :------------------------------- |
| **灵魂伤害** (Soul Damage)  | \+0.5% 综合伤害           | 1-10 级          | 1 点                             |
|                             |                           | 11-20 级         | 2 点                             |
|                             |                           | 21+ 级           | 3 点                             |
| **灵魂防御** (Soul Defense) | \+1 基础防御              | 1-5 级           | **2 点**                         |
|                             |                           | 6-10 级          | 3 点                             |
|                             |                           | 11+ 级           | 4 点                             |
| **灵魂敏捷** (Soul Agility) | \+0.5% 移动速度           | 1-10 级          | 2 点                             |
|                             |                           | 11-20 级         | 3 点                             |

**设计解析：**

1. **伤害 (Soul Damage):** 相对便宜，鼓励玩家在早期投入以获得即时反馈。
2. **防御 (Soul Defense):** 初始成本较高（2 点基础点换 1 点防御），这完全符合您“肉山前，一点防御则需要两点”的思路。这使得早期堆防御的代价很高，但后期点数富裕时依然是有效投资。
3. **敏捷 (Soul Agility):** 移动速度是《泰拉瑞亚》中的核心属性，因此其成本略高于伤害。
4. **自动缩放 (Auto-Scaling):** 此设计无需在肉山后“调整数值”。肉山前（1-40 级）获得的 40 个点，玩家可能会在 1-2 成本的等级中分配。而在困难模式中（41-80 级）获得的新点数，虽然购买力（相对）下降了，但仍然可以用于补足其他属性，或继续投资主力属性，实现了自动平衡。

---

## **第 2 部分：界面(UI)设计：灵魂核心**

本部分将分析报告中关于“灵魂”、“谐振”和“Boss 门控”的 UI 构思 1 转化为一个具体、可实现的界面设计方案。UI 的最终目标是清晰地传达“世界谐振”的门控机制。

### **2.1. 布局与视觉主题**

- **核心概念：** 界面主题为“灵魂核心”（Soul Core）。采纳 1 建议的“暗色、宇宙或以太”风格。UI 背景应为动态的、缓慢旋转的星云或“灵魂之河”视觉效果，以强化“灵魂”与“谐振”的主题。
- **布局结构：** 放弃传统的“从上到下”的树状图，转而采用 1 建议的“放射状”布局，以“灵魂核心”为中心。
  1. **中央核心（Central Core）：** 屏幕中心是一个大型的、发光的“灵魂核心”。这是所有天赋分支的起点。
  2. **谐振环（Attunement Rings）：** 为完美结合“谐振阶段”1 与 UI 1，设计 8 个同心圆环围绕“灵魂核心”展开，如同树的年轮。每一“环”代表一个“谐振阶段”（见表 1.2.1）。第 1 环对应 1-10 级，第 2 环对应 11-20 级，以此类推。
  3. **天赋分支（Talent Branches）：** 三个天赋分支（详见第 3 部分）将从“灵魂核心”出发，呈 120 度角向外放射，穿过这 8 个同心圆环。
  4. **（新增）基础点面板 (Basic Point Panel):** 在“灵魂核心”主界面的一个角落（例如左下角），应有一个小型的、可折叠的面板，用于分配“基础点”。此面板应包含表 1.3.2 中的三项属性（伤害、防御、敏捷）及其对应的“+”按钮，以供玩家分配点数。

### **2.2. 节点状态与交互**

UI 必须在任何时候都清楚地告诉玩家“我能点什么？”以及“我为什么不能点那个？”。这是实现 1“限制”理念和 1“清晰传达”要求的关键。

表 2.2.1: 节点状态视觉规范  
此表为 UI 美术和程序员提供明确的视觉和逻辑指令 1。

| 状态 (Status)                                      | 视觉表现 (Visuals)                                                             | 逻辑 (Logic)                                                                                        | 工具提示 (Tooltip)                                        |
| :------------------------------------------------- | :----------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------- | :-------------------------------------------------------- |
| **已激活** (Active)                                | 明亮的金色/灵魂蓝色，永久高亮，有光晕。                                        | 已花费天赋点。                                                                                      | \[天赋名称\]: \[天赋描述\]                                |
| **可解锁** (Unlockable)                            | 柔和的白色脉动光芒。图标完全可见。                                             | 1\. 玩家拥有至少 1 个天赋点。 2\. 玩家等级已达到此节点的等级要求。 3\. 前置节点（如果存在）已激活。 | "点击以激活。 消耗：1 天赋点"                             |
| **已锁定 \- 点数** (Locked \- Insufficient Points) | 昏暗的灰色图标，无光芒。                                                       | 1\. 玩家天赋点为 0。 2\. 玩家已达到此节点的等级要求。                                               | "\[天赋名称\] 解锁需要：天赋点"                           |
| **已锁定 \- 谐振** (Locked \- Attunement)          | **(关键状态)** 暗红色/紫色。节点被可见的“锁链”或“邪恶触须”（如腐化之地）缠绕。 | 1\. 玩家等级未达到此节点的等级要求（即 $MaxLevelCap$ 不足）。                                       | "\[天赋名称\] **需要更高的世界谐振** 击败 以解锁此阶段。" |

### **2.3. 交互流程**

- **打开界面：** 玩家通过可配置的热键打开“灵魂核心”界面。
- **花费点数：** 左键点击“可解锁”节点。一个“灵魂能量”的视觉特效会从中央核心流向该节点，将其“激活”。
- **天赋重置（Respec）机制：** 1 的设计哲学（路径 B）强调了“灵活性”。如果天赋点不能重置，当玩家想从法师换成战士时，系统就会变得不灵活，从而违背了初衷。因此，必须提供一个“合理”的重置机制。
  - **设计：** 玩家可以在“向导”NPC 处，花费一定金钱（例如，每点天赋 1 金币）来重置所有**天赋点**，或者在“恶魔祭坛”处合成一个“遗忘之魂”物品来一次性重置。（**注：** “基础点”一旦分配，建议永久生效且不可重置，以增加其分配的“重量感”，并与“天赋点”的灵活性形成对比。）

---

## **第 3 部分：基础天赋树：节点详述**

- 参见具体文档**节点设计**

---

## **第 4 部分：实现要点与性能考量**

本部分重申分析报告 1 中的技术建议，确保模组的“高性能”目标得以实现。

### **4.1. 推荐的技术实现**

- **数据存储：** 所有数据（XP、等级、已激活的节点 ID、已分配的基础点）必须存储在 ModPlayer 中。使用 SaveData / LoadData 钩子进行保存和加载。这是最高性能且最灵活的实现方式 1。
- **属性应用：** 使用 ModPlayer 的 ModifyWeaponDamage, ModifyWeaponCrit, ModifyWeaponUseTime, ModifyHitNPC 等标准钩子全局应用属性。这些钩子只在需要时运行，开销极低。
- **门控检查：** 检查 Boss 标志 (如 NPC.downedBoss1) 是一个零开销的布尔值检查，可以在 UI 打开时或升级时执行 1。

### **4.2. 性能与平衡性规避**

分析报告 1 指出了此类模组常见的“性能陷阱”。本设计方案已主动规避了这些陷阱：

- **规避弹幕泛滥：** 1 警告过“+1 弹幕”天赋可能导致帧数崩溃。本设计严格遵循了这一建议。例如，AGG-5 节点（虚空回响）被特意设计为低概率（5%）的“debuff 复制弹幕”而非“伤害弹幕”。这既“有趣”又“高性能”。
- **UI 性能：** “灵魂核心”UI 的动态背景（星云）应使用低开销的着色器（Shader）或平铺的动态贴图，而不是粒子系统。UI 只应在玩家打开时才更新其状态，而不是在后台每帧都刷新。
